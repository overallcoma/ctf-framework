FROM php:apache

ARG var_flagpage
ARG var_password

WORKDIR /var/www/html

RUN mkdir -p /db/

COPY errorpage.html /var/www/html/error.html
COPY flagpage.html /var/www/html/${var_flagpage}
COPY htaccess /var/www/html/.htaccess
COPY index.php /var/www/html/index.php
COPY passhashgen.php /var/www/html/passhashgen.php
COPY dbsetup.sql /db/dbsetup.sql
COPY files/passinsert.sh /db/passinsert.sh

RUN apt update -y
RUN apt install sqlite3 -y

RUN echo $var_password > /var/www/html/password.txt
RUN php /var/www/html/passhashgen.php
RUN touch /db/password.db
RUN chmod +x /db/passinsert.sh
RUN /bin/bash -c /db/passinsert.sh
RUN sqlite3 /db/password.db < /db/dbsetup.sql

EXPOSE 80